<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Virtual Green Fleet Orchestrator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
    <script src="https://unpkg.com/phosphor-icons"></script>
</head>
<body class="p-4 lg:p-6 light-mode">

    <!-- Header -->
    <header class="flex items-center justify-between mb-6">
        <div class="flex items-center space-x-3">
            <svg width="40" height="40" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="text-blue-500">
                <path d="M12 22C17.5228 22 22 17.5228 22 12C22 6.47715 17.5228 2 12 2C6.47715 2 2 6.47715 2 12C2 17.5228 6.47715 22 12 22Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M16.24 7.76C15.0748 6.59762 13.5573 6.00133 12 6C10.4427 6.00133 8.92525 6.59762 7.76002 7.76M18.36 5.64C16.8243 4.10351 14.4735 3.22473 12 3.22473C9.52652 3.22473 7.17569 4.10351 5.64002 5.64" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M12 12L8 8" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M12 18V12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            <h1 class="text-2xl lg:text-3xl font-bold text-white">VGF Orchestrator</h1>
        </div>
        <div class="flex items-center space-x-4">
            <button id="theme-toggle" class="p-2 rounded-md btn-secondary" title="Toggle Dark Mode">
                <i id="theme-icon" class="ph-moon text-lg"></i>
            </button>
            <div id="current-time" class="hidden md:block text-lg font-medium text-gray-400"></div>
        </div>
    </header>
    
    <!-- Utility Value Proposition KPIs -->
    <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
        <div class="card p-4 text-center">
            <p class="text-sm text-gray-400 flex items-center justify-center"><i class="ph-buildings text-lg mr-2"></i>Capital Deferral</p>
            <p class="text-2xl font-bold text-white">$<span class="animated-number" id="kpi-capex"></span>M</p>
        </div>
        <div class="card p-4 text-center">
            <p class="text-sm text-gray-400 flex items-center justify-center"><i class="ph-chart-line-up text-lg mr-2"></i>Peak Load Reduction</p>
            <p class="text-2xl font-bold text-white"><span class="animated-number" id="kpi-peak"></span> MW</p>
        </div>
        <div class="card p-4 text-center">
            <p class="text-sm text-gray-400 flex items-center justify-center"><i class="ph-money text-lg mr-2"></i>Market Revenue</p>
            <p class="text-2xl font-bold text-white">$<span class="animated-number" id="kpi-revenue"></span>K</p>
        </div>
        <div class="card p-4 text-center">
            <p class="text-sm text-gray-400 flex items-center justify-center"><i class="ph-handshake text-lg mr-2"></i>Enrolled Fleets</p>
            <p class="text-2xl font-bold text-white animated-number" id="kpi-fleets"></p>
        </div>
    </div>

    <!-- Main Dashboard Grid -->
    <div class="grid grid-cols-1 lg:grid-cols-4 gap-6">

        <!-- Left Panel: Fleets -->
        <div class="lg:col-span-1 flex flex-col gap-6">
            <div class="card p-4 flex-grow">
                <h2 class="text-xl font-bold mb-4 text-white">Enrolled Fleets</h2>
                <div id="fleet-list" class="space-y-3 overflow-y-auto max-h-[calc(100vh-300px)]">
                    <!-- Fleet items will be injected here -->
                </div>
            </div>
        </div>

        <!-- Center Panel: Chart & Controls -->
        <div class="lg:col-span-2 card p-4 flex flex-col">
            <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-4">
                <h2 class="text-xl font-bold text-white">System Power Flow</h2>
                <div class="flex space-x-2 mt-2 sm:mt-0">
                    <button id="mode-live" class="px-4 py-2 rounded-md font-semibold text-sm active-mode">Live Mode</button>
                    <button id="mode-sim" class="px-4 py-2 rounded-md font-semibold text-sm btn-secondary">Simulation</button>
                </div>
            </div>
            <div class="flex-grow min-h-[300px]">
                <canvas id="powerChart"></canvas>
            </div>
            <div id="sim-controls" class="hidden mt-4 p-4 bg-gray-900/50 rounded-lg">
                <h3 class="font-bold text-lg mb-2 text-white">Synthetic Telematics & Planning Engine</h3>
                <p class="text-sm text-gray-400 mb-3">Configure a potential fleet (or choose an existing template) to simulate its grid impact and financial value.</p>
                <div class="grid grid-cols-1 sm:grid-cols-3 gap-4 mb-4">
                    <input id="fleet-name-input" type="text" placeholder="Fleet Name" class="p-2 rounded-md bg-gray-800 border border-gray-600 text-white">
                    <select id="vehicle-type-select" class="p-2 rounded-md bg-gray-800 border border-gray-600 text-white">
                        <option value="School Bus">School Bus</option>
                        <option value="Delivery Van">Delivery Van</option>
                        <option value="Municipal Car">Municipal Car</option>
                        <option value="Rideshare">Rideshare</option>
                        <option value="Refuse Truck">Refuse Truck</option>
                        <option value="Yard Tractor">Yard Tractor</option>
                    </select>
                    <input id="vehicle-count-input" type="number" min="1" placeholder="Vehicle Count" class="p-2 rounded-md bg-gray-800 border border-gray-600 text-white">
                </div>
                <div class="flex flex-col sm:flex-row gap-4 mb-2">
                    <select id="sim-fleet-select" class="flex-grow p-2 rounded-md bg-gray-800 border border-gray-600 text-white">
                        <!-- Sim fleet options will be injected here -->
                    </select>
                    <button id="run-sim-btn" class="btn-primary px-4 py-2 rounded-md font-bold flex-shrink-0">Run Simulation</button>
                </div>
                <div id="sim-results" class="hidden mt-4 text-center p-3 bg-green-900/50 border border-green-500 rounded-lg">
                    <p class="font-bold text-green-300">Financial Pro-Forma Complete</p>
                    <p id="sim-revenue" class="text-white text-lg"></p>
                    <p id="sim-tco" class="text-sm text-gray-300"></p>
                    <button id="onboard-fleet-btn" class="btn-primary mt-3 px-4 py-2 rounded-md hidden">Onboard Fleet</button>
                </div>
            </div>
        </div>

        <!-- Right Panel: Status & Log -->
        <div class="lg:col-span-1 flex flex-col gap-6">
            <div class="card p-4">
                <h2 class="text-xl font-bold mb-4 text-white">Grid Status</h2>
                <div class="space-y-3">
                    <div class="flex justify-between items-center">
                        <span class="font-medium text-gray-300">Frequency</span>
                        <span id="grid-freq" class="font-bold text-lg text-white">60.00 Hz</span>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="font-medium text-gray-300">System Demand</span>
                        <span id="grid-demand" class="font-bold text-lg text-white">0 MW</span>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="font-medium text-gray-300">Market Price</span>
                        <span id="grid-price" class="font-bold text-lg text-green-400">$0/MWh</span>
                    </div>
                </div>
            </div>
            <div class="card p-4 flex-grow">
                <h2 class="text-xl font-bold mb-4 text-white">Orchestrator Event Log</h2>
                <div id="event-log" class="space-y-2 overflow-y-auto h-80 text-sm">
                    <!-- Log entries will be injected here -->
                </div>
            </div>
        </div>

    </div>

    <script src="app.js"></script>
</body>
</html>
